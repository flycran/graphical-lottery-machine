window.addEventListener("DOMContentLoaded",function(){var _Mathabs=Math.abs,_Mathround=Math.round;let cvs=f("#cvs");cvs.width=480,cvs.height=320;let ctx=cvs.getContext("2d"),text=f("#text"),yg=f("#yg"),setUpIcon=f("#setUp-icon"),setDownIcon=f("#setDown-icon"),setUp=f("#setUp"),setData=f("#setData"),setDateInput=setData.f("input"),setDataButton=setData.f("button");setUpIcon.onclick=function(){setUp.style.visibility=""},setDownIcon.onclick=function(){setUp.style.visibility="hidden"},window.luck={list:[],s:{fx:a=>a*luck.maxV/luck.sTime,Fx:a=>a**2*luck.maxV/luck.sTime/2},p:{fx:()=>luck.maxV,Fx:a=>a*luck.maxV},e:{fx:a=>luck.maxV-a**(1/luck.eoffN)/luck.eoffC,Fx:a=>-(luck.eoffN*a**(1+1/luck.eoffN)-luck.cSpeed*luck.eoffC*a*(luck.eoffN+1))/(luck.eoffC*(luck.eoffN+1)),ft:()=>(luck.eoffC*luck.cSpeed)**luck.eoffN},c:{fx:()=>luck.cV,Fx:a=>a*luck.cV*luck.coffC},setDataf(b){["maxV","eoffN","sTime","eTime"].forEach((c,a)=>{luck.setData[c](b[a])})},indexOf(a){for(let b=0;b<luck.list.length;b++)if(luck.list[b].v===a)return b},setData:{maxV(a){luck.maxV=a,luck.eoffC=luck.eTime**(1/luck.eoffN)/luck.maxV},sTime(a){luck.sTime=a},eTime(a){luck.eTime=a,luck.eoffC=luck.eTime**(1/luck.eoffN)/luck.maxV},eoffN(a){luck.eoffN=a,luck.eoffC=luck.eTime**(1/luck.eoffN)/luck.maxV}},history:{list:[],add(a){this.list.push({i:a,name:luck.list[a].v})}},getData(){return{maxV:luck.maxV,sTime:luck.sTime,eTime:luck.eTime,eoffC:luck.eoffC,eoffN:luck.eoffN,maxT:this.e.ft(),maxS:this.e.Fx(this.e.ft())}},maxTop:0,maxV:0,cV:.015,sTime:0,eTime:0,eoffC:0,eoffN:1,coffC:0,top:0,time:0,speed:0,cTop:0,cTime:0,cSpeed:0,timeId:null,frameTime:5,font:"1.6rem Arial",state:"\u9759\u6B62",ele:{cvs,ctx,setUpIcon,setDownIcon},setTop(a){return this.top=a,this.draw(),a},setIndex(a){return this.setTop=30*(a-5),a},setName(b){this.list.forEach((c,a)=>{if(c.v===b)return this.setIndex=a,b})},round:(a,b)=>_Mathround(a*10**b)/10**b,randomList(){this.list=this.list.sort(()=>Math.random()-.5),this.list.forEach((b,a)=>{b.i=a,b.top=30*(a+1)-15}),this.draw()},frameRate(a){return a?void(this.frameTime=1e3/a):1e3/this.frameTime},fPre:{index:void 0,change(a){if(this.index!==void 0){let b=(_Mathround((luck.cTop+luck.e.Fx(a))%luck.maxTop/30)+5)%luck.list.length;luck.cTop+=30*(this.index-b)}this.f&&this.f(luck)},f(){this.index=void 0}},pre(a){let b=this.cTop+this.e.Fx(a),c=_Mathround(b%this.maxTop/30),d=30*c+(b-b%this.maxTop);return this.preInf={index:_Mathround(this.top%this.maxTop/30),preIndex:(c+5)%this.list.length,preTop:d,nachTop:d-this.top},this.preInf},sCache(){this.cTop=this.top,this.cTime=this.time,this.cSpeed=this.speed},reckonTop(a){this.time+=this.frameTime;let b=this.time-this.cTime;this.speed=this.round(a.fx(b),5),this.top=this.round(a.Fx(b)+this.cTop,2),this.draw()},start(){this.state="\u52A0\u901F",this.sCache(),this.timeId=meterTime(()=>{this.reckonTop(this.s),this.time-this.cTime>=this.sTime&&(this.timeId(),this.proces())},this.frameTime)},proces(){this.state="\u5300\u901F",this.sCache(),this.timeId=meterTime(()=>{this.reckonTop(this.p)},this.frameTime)},end(){this.timeId(),this.state="\u51CF\u901F",this.sCache();let a=this.e.ft();1<=this.speed&&this.fPre.change(a),this.pre(a),this.timeId=meterTime(()=>{this.reckonTop(this.e),this.time-this.cTime>=a&&(this.timeId(),this.correct())},this.frameTime)},correct(){this.sCache(),this.state="\u7EA0\u6B63";let a=this.top%this.maxTop/30,b=_Mathround(a);this.coffC=a<b?1:-1,this.history.add((b+5)%this.list.length);let c=_Mathabs((this.preInf.preTop-this.top)/this.cV);this.timeId=meterTime(()=>{this.reckonTop(this.c),this.time-this.cTime>=c&&(this.top=this.preInf.preTop,this.speed=0,this.draw(),this.timeId(),this.state="\u9759\u6B62",yg.innerHTML="\u5F00\u59CB")},this.frameTime)},nearest(){let b,c=this.top%this.maxTop,d=this.maxTop;return this.list.forEach(e=>{_Mathabs(c-e.top)<d&&(d=_Mathabs(c-e.top),b=e)}),b},draw(){cvs.width=cvs.width;let a,b,c=this.top,d=this.list,g=this.nearest(),h=g.i,j=0;for(;!0&&!(480<a);)b=h-this.list.length*j,b>=this.list.length&&(j++,b=h-this.list.length*j),a=this.list[b].top-this.top+this.maxTop*j-2,ctx.font=this.font,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(d[b].v,240,a),h++},saveSet(){let a=[luck.maxV,luck.eoffN,luck.sTime,luck.eTime];localStorage.setItem("luck.setData",JSON.stringify(a))}},luck.frameRate(60);{let a=localStorage.getItem("luck.setData");a="[object Object]"!==a&&a?JSON.parse(a):[2,4,1e3,3e3],luck.setDataf(a)}text.addEventListener("keydown",function(a){"Enter"===a.code&&this.blur()}),text.onchange=function(){v=this.value,localStorage.setItem("luck-list",v),v=v.split("");let b=!0;v=v.filter(c=>{if(" "!==c)return b=!0,!0;return b?(b=!1,!0):void 0}),v&&(v=v.join("").replace(/ /g,"\uFF0C").split("\uFF0C"),luck.list=[],v.forEach((b,a)=>{luck.list.push({v:b,i:a,top:30*(a+1)-15})}),luck.maxTop=30*v.length,luck.draw())};{let a=localStorage.getItem("luck-list");a&&(text.value=a,text.onchange())}yg.onclick=function(){setUp.style.visibility="hidden","\u9759\u6B62"===luck.state?(this.innerHTML="\u505C\u6B62",luck.start()):("\u5300\u901F"===luck.state||"\u52A0\u901F"===luck.state)&&luck.end()};{let fPre=localStorage.getItem("luck.fPre");fPre&&eval(fPre),localStorage.setItem("luck.fPre",null)}setDateInput[0].onchange=function(){luck.setData.maxV(+this.value),luck.saveSet()},setDateInput[1].onchange=function(){luck.setData.sTime(+this.value),luck.saveSet()},setDateInput[2].onchange=function(){luck.setData.eTime(+this.value),luck.saveSet()},setDateInput[3].onchange=function(){luck.setData.eoffN(+this.value),luck.saveSet()},setDateInput[0].value=luck.maxV,setDateInput[1].value=luck.sTime,setDateInput[2].value=luck.eTime,setDateInput[3].value=luck.eoffN,setDataButton.onclick=function(){luck.randomList()}});